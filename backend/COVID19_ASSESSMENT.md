# COVID-19重型诊断系统实现文档

## 概述
本系统实现了COVID-19重型诊断功能，根据国家卫健委发布的诊断标准，自动评估患者是否为COVID-19重型病例。

## 重型诊断标准

满足以下任何一条即可诊断为重型：

| 诊断指标 | 标准值 | 临床意义 |
|---------|--------|----------|
| 呼吸频率 | ≥30次/分 | 提示呼吸窘迫 |
| 氧饱和度 | ≤93% | 提示缺氧状态 |
| 氧合指数 | ≤300mmHg | 提示肺功能受损 |
| 肺部病灶进展 | >50% | 提示病情快速进展 |

## 数据来源映射

| 诊断指标 | 数据来源 | 具体字段 |
|---------|---------|---------|
| 呼吸频率 | physical_examination_detail表 | respiration |
| 氧饱和度 | patient_info表 | oxygen_saturation |
| 氧合指数 | patient_info表 | arterial_oxygenation_index |
| 肺部病灶进展 | physical_examination_detail表 | ct_imaging_findings（文本分析） |

## 数据库设计

### 1. covid19_assessment表
存储COVID-19诊断结果，包括：
- 各项诊断标准的判断结果和实际值
- 满足标准数量
- 是否为重型
- 严重程度分级
- 诊断依据和建议措施

### 2. covid19_patient_relation表
管理诊断结果与患者的关联关系

## 系统架构

### 核心类
- **Covid19Assessment**：诊断结果实体类
- **Covid19PatientRelation**：患者关联实体类
- **Covid19AssessmentMapper**：诊断结果数据访问层
- **Covid19PatientRelationMapper**：关联关系数据访问层
- **Covid19AssessmentService**：诊断服务实现
- **Covid19AssessmentController**：REST API控制器

### API接口

#### 1. 单个患者诊断
```
POST /api/covid19/assess/{patientId}
```
对指定患者进行COVID-19重型诊断

#### 2. 批量诊断
```
POST /api/covid19/assess/all
```
对所有患者进行COVID-19重型诊断

#### 3. 健康检查
```
GET /api/covid19/health
```
检查服务运行状态

## 使用说明

### 1. 执行数据库脚本
```sql
-- 执行 sql/covid19_tables.sql 创建必要的表
```

### 2. 重启应用
重启Spring Boot应用使新代码生效

### 3. 调用诊断接口
- 单个患者：`/api/covid19/assess/{patientId}`
- 所有患者：`/api/covid19/assess/all`

### 4. 查看诊断结果
- 结果存储在covid19_assessment表中
- 通过covid19_patient_relation表关联患者信息

## 严重程度分级

根据满足的标准数量，系统将患者分为以下级别：

| 满足标准数 | 严重程度 | 临床建议 |
|-----------|---------|----------|
| 0项 | 非重型 | 常规治疗和监测 |
| 1项 | 重型 | 密切监测，氧疗支持 |
| 2项 | 重型（中危） | 转入重症监护，持续氧疗 |
| ≥3项 | 重型（高危） | 立即收入ICU，机械通气 |

## 诊断逻辑说明

### 呼吸频率判断
直接从体检记录中获取respiration字段值，判断是否≥30次/分

### 氧饱和度判断
从患者基本信息中获取oxygen_saturation字段值，判断是否≤93%

### 氧合指数判断
从患者基本信息中获取arterial_oxygenation_index字段值，判断是否≤300mmHg

### 肺部病灶进展判断
通过分析CT报告文本，查找"进展"、"进行性"、"明显加重"、"快速发展"等关键词

## 临床意义

### 重型患者的处理原则
1. **呼吸支持**：根据缺氧程度给予相应的氧疗或机械通气
2. **抗病毒治疗**：及时使用抗病毒药物
3. **免疫调节**：适当使用糖皮质激素等免疫调节剂
4. **对症支持**：维持水电解质平衡，营养支持
5. **预防并发症**：预防深静脉血栓、继发感染等

### 监测重点
1. 血氧饱和度：持续监测，维持SpO2≥93%
2. 呼吸频率：观察呼吸窘迫征象
3. 胸部影像学：定期复查，观察病灶变化
4. 实验室指标：监测炎症指标、凝血功能等

## 注意事项

1. **数据完整性**：诊断准确性依赖于数据的完整性
2. **肺部病灶进展**：目前通过文本分析判断，准确性有限
3. **动态评估**：COVID-19病情变化快，建议每日评估
4. **综合判断**：系统诊断仅供参考，需结合临床实际
5. **重复诊断**：系统会跳过已有诊断记录的患者

## 数据限制

当前系统的数据限制：
- 肺部病灶进展需要对比不同时间点的影像学资料，目前仅通过文本分析
- 缺少其他辅助诊断指标如D-二聚体、铁蛋白等
- 无法判断危重型（需要呼吸衰竭、休克、多器官功能衰竭等指标）

## 扩展建议

1. 增加危重型诊断功能
2. 整合更多实验室指标（D-二聚体、铁蛋白、LDH等）
3. 支持影像学定量分析
4. 增加预后评估模型
5. 支持时序诊断，追踪病情演变
6. 增加治疗方案推荐
7. 整合疫苗接种信息
8. 支持变异株分型诊断
