# CPIS评分系统实现文档

## 概述
CPIS（Clinical Pulmonary Infection Score，临床肺部感染评分）是一种用于评估肺部感染可能性的临床评分系统。本系统已经实现了自动化的CPIS评分功能。

## 评分标准

### 1. 体温评分 (0-2分)
- **0分**：36.5-38.4℃
- **1分**：38.5-38.9℃
- **2分**：≥39℃ 或 ≤36℃

### 2. 血白细胞计数评分 (0-2分)
- **0分**：默认值（当前系统中白细胞计数数据不可用，固定为0分）
- ~~**1分**：<4 或 >11×10^9/L~~
- ~~**2分**：<4 或 >11×10^9/L 且带状核>50%~~

### 3. 分泌物评分 (0-1分)
- **0分**：主诉中无"咳痰"字样
- **1分**：主诉中有"咳痰"字样

### 4. 氧合指数评分 (0-2分)
- **0分**：>240mmHg 或无ARDS
- **2分**：≤240mmHg 且无ARDS

### 5. 胸片浸润影评分 (0-2分)
- **0分**：默认值（当前系统中胸片数据不可用，固定为0分）
- ~~**1分**：斑片状浸润影~~
- ~~**2分**：局限性浸润影~~

### 6. 气管吸取物/痰培养评分 (0-2分)
- **0分**：默认值（当前系统中培养数据不可用，固定为0分）
- ~~**2分**：阳性~~

## 风险分级
- **总分范围**：0-5分（体温2分+白细胞0分+分泌物1分+氧合指数2分+胸片0分+培养0分）
- **总分≤6分**：低风险，肺部感染可能性较低（注：当前系统最高分仅5分）
- **总分>6分**：高风险，肺部感染可能性较高（注：当前系统无法达到此分数）

## 数据来源

系统从以下表和字段获取评分所需数据：

### patient_info表
- `chief_complaint`：主诉（用于判断是否有"咳痰"）
- `arterial_oxygenation_index`：动脉血气氧合指数

### physical_examination_detail表
- `temperature`：体温

## 数据库设计

### 1. cpis_assessment_result表
存储CPIS评分结果，包括：
- 各项评分指标得分
- 实际数值记录
- 总分和风险评估
- 评估时间和方法

### 2. cpis_patient_relation表
管理CPIS评分与患者的关联关系

## API接口

### 1. 单个患者评分
```
POST /api/cpis/assess/{patientId}
```
为指定患者执行CPIS评分

### 2. 批量评分
```
POST /api/cpis/assess/all
```
为所有患者执行CPIS评分

## 使用说明

1. **执行数据库脚本**
   ```sql
   -- 执行 sql/cpis_tables.sql 创建必要的表
   ```

2. **调用评分接口**
   - 单个患者：`/api/cpis/assess/{patientId}`
   - 所有患者：`/api/cpis/assess/all`

3. **查看评分结果**
   - 结果存储在cpis_assessment_result表中
   - 通过cpis_patient_relation表关联患者信息

## 注意事项

1. **数据完整性**：评分准确性依赖于患者信息的完整性，建议在评分前确保相关数据已录入
2. **白细胞计数**：当前系统中白细胞计数数据不可用，该项评分固定为0分
3. **分泌物评分**：简化为仅判断主诉中是否包含"咳痰"字样，最高1分
4. **胸片浸润影**：当前系统中胸片数据不可用，该项评分固定为0分
5. **气管吸取物/痰培养**：当前系统中培养数据不可用，该项评分固定为0分
6. **氧合指数**：需要在patient_info表的arterial_oxygenation_index字段中录入数据
7. **评分限制**：由于多项数据不可用，当前系统CPIS总分最高仅5分，所有患者均会被评为低风险

## 扩展建议

1. 如果未来能获取白细胞计数数据，可添加相关字段并完善评分逻辑
2. 如果未来能获取胸片影像学数据，可完善胸片浸润影评分逻辑
3. 如果未来能获取痰培养或气管吸取物培养数据，可完善培养评分逻辑
4. 调整风险分级阈值以适应当前的评分范围（0-5分）
5. 支持多次评分记录，追踪患者评分变化趋势
6. 增加评分结果可视化展示
7. 支持自定义评分规则配置
