# SOFA评分系统实现文档

## 概述
SOFA (Sequential Organ Failure Assessment，序贯器官功能衰竭评估) 是一个用于评估危重患者器官功能障碍严重程度的评分系统。该系统实现了自动化的SOFA评分功能。

## SOFA评分标准

评估6个器官系统，每个系统0-4分，总分0-24分：

### 1. 呼吸系统（基于PaO2/FiO2）
| PaO2/FiO2 (mmHg) | 评分 |
|------------------|------|
| ≥400 | 0 |
| <400 | 1 |
| <300 | 2 |
| <200 (需呼吸支持) | 3 |
| <100 (需呼吸支持) | 4 |

### 2. 凝血系统（基于血小板计数）
| 血小板 (×10^9/L) | 评分 |
|-----------------|------|
| ≥150 | 0 |
| <150 | 1 |
| <100 | 2 |
| <50 | 3 |
| <20 | 4 |

### 3. 肝脏系统（基于胆红素）
| 胆红素 (μmol/L) | 评分 |
|----------------|------|
| <33 | 0 |
| 33-101 | 1 |
| 102-203 | 2 |
| 204-340 | 3 |
| >340 | 4 |

### 4. 心血管系统（基于MAP和血管活性药物）
| 心血管状态 | 评分 |
|-----------|------|
| MAP ≥70 mmHg | 0 |
| MAP <70 mmHg | 1 |
| 多巴胺≤5 或多巴酚丁胺 | 2 |
| 多巴胺>5 或去甲肾上腺素≤0.1 | 3 |
| 多巴胺>15 或去甲肾上腺素>0.1 | 4 |

### 5. 神经系统（基于GCS）
| 格拉斯哥昏迷评分 | 评分 |
|-----------------|------|
| 15 | 0 |
| 13-14 | 1 |
| 10-12 | 2 |
| 6-9 | 3 |
| <6 | 4 |

### 6. 肾脏系统（基于肌酐）
| 肌酐 (μmol/L) | 评分 |
|--------------|------|
| <110 | 0 |
| 110-170 | 1 |
| 171-299 | 2 |
| 300-440 | 3 |
| >440 | 4 |

## 严重程度分级

- **0-3分**：正常或轻微
- **4-7分**：轻度器官功能障碍
- **8-11分**：中度器官功能障碍
- **12-14分**：重度器官功能障碍
- **≥15分**：极重度器官功能障碍

## 数据来源映射

| 评分指标 | 数据来源 | 具体字段 |
|---------|---------|---------|
| 氧合指数 | patient_info表 | arterial_oxygenation_index |
| 血小板计数 | patient_info表 | platelet_count |
| 总胆红素 | patient_info表 | total_bilirubin |
| 血压 | physical_examination_detail表 | systolic_bp, diastolic_bp |
| 血管活性药物 | patient_info表 | dopamine_used, dobutamine_used, norepinephrine_used |
| 格拉斯哥评分 | 暂不可用 | - |
| 肌酐 | patient_info表 | serum_creatinine |

## 数据库设计

### 1. sofa_assessment表
存储SOFA评分结果，包括：
- 6个器官系统的单项评分
- 实际测量值记录
- 总分和器官衰竭数量
- 严重程度和评估结论

### 2. sofa_patient_relation表
管理评分结果与患者的关联关系

## 系统架构

### 核心类
- **SofaAssessment**：评分结果实体类
- **SofaPatientRelation**：患者关联实体类
- **SofaAssessmentMapper**：评分结果数据访问层
- **SofaPatientRelationMapper**：关联关系数据访问层
- **SofaAssessmentService**：评分服务实现
- **SofaAssessmentController**：REST API控制器

### API接口

#### 1. 单个患者评分
```
POST /api/sofa/assess/{patientId}
```
对指定患者进行SOFA评分

#### 2. 批量评分
```
POST /api/sofa/assess/all
```
对所有患者进行SOFA评分

#### 3. 健康检查
```
GET /api/sofa/health
```
检查服务运行状态

## 使用说明

### 1. 执行数据库脚本
```sql
-- 执行 sql/sofa_tables.sql 创建必要的表
```

### 2. 重启应用
重启Spring Boot应用使新代码生效

### 3. 调用评分接口
- 单个患者：`/api/sofa/assess/{patientId}`
- 所有患者：`/api/sofa/assess/all`

### 4. 查看评分结果
- 结果存储在sofa_assessment表中
- 通过sofa_patient_relation表关联患者信息

## 评分逻辑说明

### 平均动脉压(MAP)计算
```
MAP = (收缩压 + 2×舒张压) / 3
```

### 器官衰竭判定
单个器官系统评分≥2分即认为该器官系统衰竭

## 临床意义

### SOFA评分的应用价值
1. **器官功能监测**：动态评估多器官功能状态
2. **预后评估**：评分越高，死亡率越高
3. **治疗决策**：指导器官支持治疗策略
4. **临床研究**：作为脓毒症诊断和研究的标准工具

### 评分变化的意义
- **评分增加**：提示病情恶化，需要加强治疗
- **评分稳定**：病情相对稳定
- **评分下降**：提示治疗有效，病情改善

## 注意事项

1. **数据完整性**：评分准确性依赖于检验数据的完整性
2. **格拉斯哥评分**：当前系统暂无GCS数据，神经系统评分默认为0
3. **血管活性药物**：需要记录药物使用情况和剂量
4. **动态评估**：建议每日或病情变化时重新评估
5. **重复评分**：系统会跳过已有评分记录的患者

## 数据限制

当前系统的数据限制：
- 格拉斯哥昏迷评分数据不可用
- 尿量数据不可用
- 血管活性药物剂量数据不完整

## 扩展建议

1. 增加格拉斯哥昏迷评分的数据采集
2. 增加尿量监测数据
3. 完善血管活性药物剂量记录
4. 支持时序评分，追踪患者SOFA评分变化趋势
5. 增加评分变化预警功能
6. 整合其他评分系统（如APACHE II）
7. 支持评分结果的可视化展示
8. 增加死亡率预测模型
